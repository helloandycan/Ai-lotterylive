<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>PowerLottery AI v2.7 - Heatmap Analysis</title>
    <style>
        :root { --neon-green: #00ff00; --dark-bg: #050a05; --dim-green: #004400; }
        body { background-color: var(--dark-bg); color: var(--neon-green); font-family: 'Courier New', monospace; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .terminal-container { width: 95%; max-width: 950px; border: 2px solid var(--dim-green); padding: 25px; background: rgba(0, 5, 0, 0.95); position: relative; }
        
        /* 熱力圖樣式 */
        .heatmap-container { display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px; margin: 20px 0; border: 1px solid var(--dim-green); padding: 10px; background: #000; }
        .heat-node { height: 35px; border: 1px solid #111; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; transition: all 0.5s; color: #003300; }
        .heat-active { color: #fff; text-shadow: 0 0 5px #fff; }

        /* 電子收據 */
        #receipt-modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #fff; color: #000; padding: 20px; width: 320px; box-shadow: 0 0 50px rgba(0,0,0,0.8);
            border: 1px solid #ccc; font-family: '微軟正黑體', sans-serif; z-index: 100;
        }
        .receipt-header { text-align: center; border-bottom: 2px dashed #000; margin-bottom: 10px; padding-bottom: 10px; }
        .receipt-item { margin: 10px 0; font-size: 0.9rem; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .receipt-balls { font-weight: bold; color: #d32f2f; font-size: 1.1rem; }

        .start-btn { width: 100%; padding: 15px; background: var(--dim-green); color: var(--neon-green); border: 1px solid var(--neon-green); cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        .start-btn:hover { background: var(--neon-green); color: #000; }
        
        .num-ball { display: inline-block; color: #fff; background: #004400; padding: 3px 8px; border-radius: 4px; margin: 2px; font-size: 0.9rem; border: 1px solid var(--neon-green); }
        .z2-ball { background: #880000; border-color: #ff0000; }
        .prediction-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; display: none; }
        .pred-card { border: 1px solid #006600; padding: 12px; background: rgba(0,20,0,0.5); }
    </style>
</head>
<body>

<div class="terminal-container">
    <div style="text-align:center;">
        <h2 style="margin:0;">威力彩 AI 物理增益熱力分析系統</h2>
        <small style="color: #ffff00;">HEURISTIC PHYSICAL HEATMAP v2.7 (EXCLUSION ENABLED)</small>
    </div>

    <div style="margin-top:20px; font-size:0.7rem;">[ 物理偏移熱度即時監測 ]</div>
    <div class="heatmap-container" id="heatmap">
        </div>

    <button class="start-btn" id="main-action" onclick="runSimulation()">啟動全變數物理模擬分析</button>

    <div id="log-console" style="height: 100px; overflow-y: auto; color: #00aa00; font-size: 0.8rem; border-left: 2px solid var(--dim-green); padding-left: 10px; margin-bottom:15px;"></div>

    <div id="prediction-result" class="prediction-grid">
        <div class="pred-card"><div style="color:#ffff00; font-size:0.8rem;">[策略 A: 穩健型]</div><div id="set1-balls"></div></div>
        <div class="pred-card"><div style="color:#ffff00; font-size:0.8rem;">[策略 B: 物理偏移]</div><div id="set2-balls"></div></div>
        <div class="pred-card"><div style="color:#ffff00; font-size:0.8rem;">[策略 C: 貝式綜合]</div><div id="set3-balls"></div></div>
        <div class="pred-card" style="border-color:#ff3333;"><div style="color:#ff3333; font-size:0.8rem;">[策略 D: 極端爆冷]</div><div id="set4-balls"></div></div>
    </div>

    <div id="action-btns" style="display:none; margin-top:15px;">
        <button class="start-btn" onclick="showReceipt()" style="background:#cc8800; border-color:#ffff00; color:#fff;">生成電子投注單 (收據格式)</button>
    </div>
</div>

<div id="receipt-modal">
    <div class="receipt-header"><strong>AI 預測投注建議單</strong><br><span id="receipt-date" style="font-size:0.7rem;"></span></div>
    <div id="receipt-content"></div>
    <div style="font-size:0.6rem; color:#666; text-align:center; margin-top:10px;">* 已排除歷史頭獎組合 *<br>驗證碼：PHYS-HEAT-9921</div>
    <button class="close-receipt" style="width:100%; margin-top:10px; cursor:pointer;" onclick="document.getElementById('receipt-modal').style.display='none'">關閉</button>
</div>

<script>
    // 模擬歷史開獎組合庫
    const PAST_HEAD_AWARDS = ["01,05,12,20,25,33|7", "10,14,21,22,28,37|4"]; 

    // 初始化熱力圖
    const heatmap = document.getElementById('heatmap');
    for(let i=1; i<=38; i++) {
        let node = document.createElement('div');
        node.className = 'heat-node';
        node.id = `heat-${i}`;
        node.textContent = i < 10 ? '0'+i : i;
        heatmap.appendChild(node);
    }

    let currentPredictions = [];

    async function runSimulation() {
        const consoleElem = document.getElementById('log-console');
        consoleElem.innerHTML = "";
        
        const logs = [
            "> 載入 2008-2026 歷史開獎指紋...",
            "> 執行 6 種硬體情境隨機權重映射...",
            "> 偵測到開獎機 M1/M2 物理偏移...",
            "> [驗證] 正在對比 22,085,448 組歷史空間...",
            "> [成功] 已過濾重複組合，鎖定唯一機率波段。"
        ];

        // 模擬熱力圖跳動
        let heatTimer = setInterval(() => {
            for(let i=1; i<=38; i++) {
                let opacity = Math.random();
                let node = document.getElementById(`heat-${i}`);
                node.style.background = `rgba(0, 255, 0, ${opacity})`;
                if(opacity > 0.7) node.classList.add('heat-active');
                else node.classList.remove('heat-active');
            }
        }, 100);

        for(let log of logs) {
            let d = document.createElement('div');
            d.textContent = log;
            consoleElem.appendChild(d);
            await new Promise(r => setTimeout(r, 600));
        }

        clearInterval(heatTimer);
        currentPredictions = [generateUniqueSet(), generateUniqueSet(), generateUniqueSet(), generateUniqueSet()];
        
        // 渲染球組
        renderBalls('set1-balls', currentPredictions[0]);
        renderBalls('set2-balls', currentPredictions[1]);
        renderBalls('set3-balls', currentPredictions[2]);
        renderBalls('set4-balls', currentPredictions[3]);

        document.getElementById('prediction-result').style.display = "grid";
        document.getElementById('action-btns').style.display = "block";
    }

    function generateUniqueSet() {
        let isNew = false;
        let set;
        while(!isNew) {
            let z1 = [];
            while(z1.length < 6) {
                let n = Math.floor(Math.random()*38)+1;
                if(!z1.includes(n)) z1.push(n);
            }
            z1.sort((a,b)=>a-b);
            let z2 = Math.floor(Math.random()*8)+1;
            set = { z1, z2 };
            let key = z1.join(',') + '|' + z2;
            if(!PAST_HEAD_AWARDS.includes(key)) isNew = true; // 排除歷史組合
        }
        return set;
    }

    function renderBalls(id, data) {
        let html = data.z1.map(n => `<span class="num-ball">${n<10?'0'+n:n}</span>`).join('');
        html += `<br><small>二區：</small><span class="num-ball z2-ball">${data.z2}</span>`;
        document.getElementById(id).innerHTML = html;
    }

    function showReceipt() {
        const content = document.getElementById('receipt-content');
        document.getElementById('receipt-date').innerText = "預測日期: " + new Date().toLocaleString();
        let html = "";
        const labels = ["方案 A (穩健)", "方案 B (物理)", "方案 C (綜合)", "方案 D (爆冷)"];
        currentPredictions.forEach((pred, i) => {
            html += `<div class="receipt-item"><strong>${labels[i]}</strong><br>一區：<span class="receipt-balls">${pred.z1.map(n=>n<10?'0'+n:n).join(' ')}</span> 二區：<span class="receipt-balls" style="color:blue;">${pred.z2}</span></div>`;
        });
        content.innerHTML = html;
        document.getElementById('receipt-modal').style.display = 'block';
    }
</script>
</body>
</html>